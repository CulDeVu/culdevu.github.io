<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Planetary Biomes</title>
  <meta name="description" content="[sort description and key words to shove in meta tags]
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://yourdomain.com/blog/2015/planetary-biomes/">
  <link rel="alternate" type="application/rss+xml" title="CulDeVu" href="http://yourdomain.com/feed.xml">
</head>


  <body>
  
    <!-- <span class="sidebar">
        hey there
    </span> -->
    <span class="sidebar-color">
    </span>
    
    <span class="content">
        
        <span class="sidebar-content">
            <span class="site-title">
    CulDeVu
</span>

<a class="nav-button" href="/">
    Home
</a>

    

    
        <a class="nav-button" href=" /portfolio/ ">
            Portfolio
        </a>
    

    
        <a class="nav-button" href=" /resume/ ">
            Resume
        </a>
    

    
        <a class="nav-button" href=" /about/ ">
            About
        </a>
    

    

    
        <a class="nav-button" href=" /about/ ">
            Posts
        </a>
    

    


<p>
    <a href="https://github.com/culdevu">
        <span class="social-media-container"><svg width="100%" height="100%" viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span>
    </a>
    <a href="https://twitter.com/culdevu">
        <span class="social-media-container"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span>
    </a>
    <a href="/feed.xml">
        <span class="social-media-container"><svg height="56.693px" id="Layer_1" version="1.1" viewBox="0 0 56.693 56.693" width="56.693px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M3.428,31.085c6.19,0,12.009,2.418,16.382,6.816c4.381,4.398,6.793,10.256,6.793,16.492h9.539  c0-18.113-14.676-32.848-32.714-32.848V31.085z M3.443,14.174c22.061,0,40.01,18.047,40.01,40.231h9.539  c0-27.445-22.229-49.77-49.549-49.77V14.174z M16.634,47.741c0,3.648-2.959,6.607-6.607,6.607S3.42,51.39,3.42,47.741  c0-3.65,2.958-6.607,6.606-6.607S16.634,44.091,16.634,47.741z"/></svg></span>
    </a>
</p>

<hr />
<br />

<p>
    <h2>Hello there!</h2>
    <p>
        [insert short description about me and what i do. make sure 
        that it's conveyed that this is a personal site and i'm available for 
        hire whenever someone shows an interest]
    </p>
</p>

<hr />
<br />

<p>
    maybe have a thingy where i'm like "look at all my old posts and shit!"
    or maybe have one of those "sort posts by catagory" things that are all the rage
</p>

        </span>
        
        <span class="content-wrapper">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Planetary Biomes</h1>
    <p class="post-meta"><time datetime="2015-04-25T00:00:00-07:00" itemprop="datePublished">Apr 25, 2015</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Not many images or videos this time around, unfortunately. It’s mostly about updates about what I’m up to and what I’m working on.</p>

<p>So, first off, the non-euclidean stretchy game thingy. Turns out that some people in my art class had taken an interest in it when I was working on it in class, and they offered to help offload some of the content generation, like making art, animations, level design, etc. This is actually exactly what I need in order to continue working on it, so you’ll be seeing some gosh-darn pretty images in the future, after finals are over! Look forward to it! Posted Image</p>

<p>In the meantime though, as I always need something to procrastinate on homework with, I’ve been playing around with a space flying simulation, one where you can get really close to the ground!</p>

<p>[attachment=26985:Screenshot 2015-04-21 16.15.17.jpg]
[attachment=26986:Screenshot 2015-04-22 20.00.50.jpg]</p>

<p>It looks a little rough right now, I know. Atmospheric scattering and physically correct lighting have taken a back seat to getting the game mechanics up and working. As you can see, though, there are biomes on the planet that try to correspond to how an actual planet’s biomes work. With the exception of icecaps and rivers and stuff that have to have a little more processing thrown at them, the biomes are roughly there. I need to work on smoothing them out and getting them to be believable colors, but I’ll work on that when I start doing close-up stuff.</p>

<p>So, down to the nitty gritty technical details of everything.</p>

<p>Biomes ‘n Stuff</p>

<p>The game world is represented in a sort of fixed-point-esque system using doubles in hopes to make it expand to more than just a single solar system. However, everything drawn on the GPU is done using floats, particularly because I don’t want to have to require GLSL version 400. So for the planet and sun that you see right now, everything is done using raytraced impostors.</p>

<p>So how do the biomes work? Well, back in Freshman year of high school I took biology, and I remember learning about a chart that determines all of the different biomes we see on earth by plotting them on a graph of average rainfall vs average temperature. Here’s a picture of it:</p>

<p>[attachment=26989:whittaker.jpg]</p>

<p>So, that’s pretty easy. For the average temperature, I took inspiration from the earth: http://upload.wikimedia.org/wikipedia/commons/a/aa/Annual_Average_Temperature_Map.jpg . I approximate it by a dot product plus offset by some value noise.
// takes normalized position rel sphere
// returns a value on [0, 1] representing the range [-15, 30] celcius
float getTemperature(vec3 p)
{
	vec3 randTempSeed = p + vec3(12, 11, 10);</p>

<pre><code>vec3 upVec = vec3(0, 1, 0);
float temp = dot(upVec, p);
if (temp &lt; 0)
	temp = -temp;
temp = 1.0 - temp + valueNoise3D(randTempSeed.x, randTempSeed.y, randTempSeed.z, 6) * 0.2;
temp = clamp(temp, float(0), float(1));
return temp; } The average rainfall on the earth doesn't look like it has any discernible pattern, so I just thew some value noise on it and called it a day. All together, here's the snippet that determines biomes: // takes normalized position rel sphere // returns a value on [0, 1] representing the range [-15, 30] float getTemperature(vec3 p) {
vec3 randTempSeed = p + vec3(12, 11, 10);

vec3 upVec = vec3(0, 1, 0);
float temp = dot(upVec, p);
if (temp &lt; 0)
	temp = -temp;
temp = 1.0 - temp + valueNoise3D(randTempSeed.x, randTempSeed.y, randTempSeed.z, 6) * 0.2;
temp = clamp(temp, float(0), float(1));
return temp; }
</code></pre>

<p>// takes normalized position rel sphere
// returns a value on [0, 1] representing the range [0, max amount of precipitation]
float getPrecipitation(vec3 p)
{
	p = p + vec3(8, 12, 19);
	float precip = (valueNoise3D(p.x, p.y, p.z, 8) + 1.0) / 2.0;
	return precip;
}</p>

<p>int getBiome(vec3 p)
{
	float temp = getTemperature(p);
	float precip = getPrecipitation(p);</p>

<pre><code>if (temp &lt; 0.25)
	return BIOME_TUNDRA;
if (precip / temp &lt; 0.15)
	return BIOME_SUBTROPIC;
if (temp &lt; 0.75 &amp;&amp; precip / temp &lt; 0.5)
	return BIOME_GRASSLAND;
if (temp &lt; 0.3)
	return BIOME_TIAGA;
if (temp &lt; 0.75 &amp;&amp; precip &lt; 0.5)
	return BIOME_DECIDUOUS;
if (temp &lt; 0.75)
	return BIOME_TEMERATE_RAINFOREST;
if (precip &lt; 0.25)
	return BIOME_SAVANNA;
if (precip &lt; 0.5)
	return BIOME_TROPICAL_FOREST;
return BIOME_TROPICAL_RAINFOREST;
return 0; } ​Translating it to C++
</code></pre>

<p>So, now with a basic rudimentary system in place for generating biomes for GLSL impostors, I need to translate it over to C++ so that I can build a mesh for when you get up close.</p>

<p>The issue is that I’ll probably end up changing things, like finding ways to make the biomes more natural (like having more rainfall around ocean edges, etc), and I’ll have to translate every single change I make to C++ as well.</p>

<p>The solution I came up with is to use the power of GLM plus the power of simple parsing, to get the C++ compiler to compile GLSL.</p>

<p>Here’s how it works:</p>

<p>My shaders get run through a very simple parser that looks for #include statements, and then starts revursively copying and pasting those files into the body of the shader (I call these files .glh). This serves a double purpose. Firstly, it makes a large GLSL codebase much cleaner and more plug-and-play, which helps with prototyping. The separate header files can also, if GLM is willing, be parsed by the C++ compiler if there’s just functions and their definitions.</p>

<p>This way, I can import all of my biome creation code into C++ by saying something like:
using glm::max;
using glm::min;
using glm::clamp;
using glm::normalize;
typedef uint32_t uint;
#include “planetImpostor.glh”
and BOOM! I’ve got the biome determination code transfered.</p>

<p>Here are some more boring screens:</p>

<p>[attachment=26987:Screenshot 2015-04-25 16.34.27.jpg]
[attachment=26988:Screenshot 2015-04-25 16.34.56.jpg]</p>

<p>Welp, I hope that interested you guys and everything! I’ll get back to you guys in a week and catch you up with everything if finals don’t get too rough.</p>

<p>Thanks for reading! Posted Image</p>

  </div>

</article>

        </span>

    </span>

    <!-- <footer class="site-footer">

  <div class="wrapper">
  
    <div>
        Copyright © 2015 CulDeVu
    </div>
    
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>CulDeVu</li>
          <li><a href="mailto:culdevu@gmail.com">culdevu@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            Include file 'icon-github.html username=site.github_username' contains invalid characters or sequences
          </li>
          

          
          <li>
            Include file 'icon-twitter.html username=site.twitter_username' contains invalid characters or sequences
          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>[sort description and key words to shove in meta tags]
</p>
      </div>
    </div>

  </div>

</footer>
 -->

  </body>

</html>
